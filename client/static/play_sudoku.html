<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Игра в судоку</title>
<style>
    body {
        background-color: #0f0f3b;
        color: aliceblue;
        margin: 20px;
        font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;
    }
    table {
        border-collapse: collapse;
        margin: 20px 0;
    }
    td {
        border: 1px solid lightskyblue;
        width: 40px; /* Фиксированная ширина */
        height: 40px; /* Фиксированная высота */
        text-align: center;
        color: aliceblue;
        background-color: #262441;
    }
    input {
        width: 40px;
        height: 40px;
        text-align: center;
        font-size: 24px;
        color: aliceblue;
        background-color: #262441;
        font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;
    }
    button {
        padding: 10px 30px;
        margin: 10px 20px 10px 0;
        font-size: 20px;
        border: none;
        border-radius: 15px;
        color: #262441;
        background-color: lightskyblue;
        font-weight: bold;
        font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;
    }
    .result {
        text-align: center;
        font-size: 24px;
    }
    .top { border-top: 4px solid lightskyblue; }
    .bottom { border-bottom: 4px solid lightskyblue; }
    .left { border-left: 4px solid lightskyblue; }
    .right { border-right: 4px solid lightskyblue; }
</style>
</head>
<body>
<!-- Кнопка выхода -->
<button id="logoutBtn">Выйти из аккаунта</button>
<button id="solveBtn">Получить решение</button>
<h1>Игра в судоку</h1>

<!-- Список судоку -->
<h2>Доступные судоку</h2>
<div id="sudokuList"></div>

<!-- Текущий судоку -->
<h2>Текущий судоку</h2>
<div id="currentSudoku"></div>

<!-- Кнопка проверки -->
<button id="checkBtn">Проверить решение</button>

<div class="result" id="resultMsg"></div>

<script>

let sudokus = [];
let currentSudoku = null;

// Загрузка списка судоку
async function loadSudokus() {
    const response = await fetch(`/api/sudoku`);
    sudokus = await response.json();
    renderSudokuList();
}

// Отрисовка списка судоку
function renderSudokuList() {
    const container = document.getElementById('sudokuList');
    container.innerHTML = '';
    sudokus.forEach(sudoku => {
        const btn = document.createElement('button');
        btn.textContent = `Судоку ${sudoku.id} (${sudoku.level})`;
        btn.onclick = () => loadSudoku(sudoku.id);
        container.appendChild(btn);
    });
}

// Загрузка конкретного судоку
async function loadSudoku(id) {
    const response = await fetch(`/api/sudoku/${id}`);
    currentSudoku = await response.json();
    renderSudoku(currentSudoku);
}

// Отрисовка судоку
function renderSudoku(sudoku) {
    const container = document.getElementById('currentSudoku');
    container.innerHTML = '';

    const table = document.createElement('table');
    const tbody = document.createElement('tbody');

    // Предположим, что у нас есть поле "puzzle" - массив из 81 элементов (или null)
    // Для заглушки создадим случайное поле или используем фиктивное
    // В реальности API должен возвращать поле "puzzle"

    // Для примера создадим фиктивное поле:

    if (!sudoku.puzzle) {
      // Создаем фиктивное поле с нулями
      sudoku.puzzle = Array(81).fill(0);
      // Можно добавить случайные числа или оставить нулями
      for (let i=0; i<81; i++) {
          if (Math.random() < 0.3) sudoku.puzzle[i] = Math.ceil(Math.random()*9);
      }
      // В реальности API возвращает поле
    }

    for (let i=0; i<9; i++) {
        const tr = document.createElement('tr');

        for (let j=0; j<9; j++) {
            const index = i*9 + j;

            let classes = '';
            if (i %3 ===0) classes += ' top';
            if (i===8) classes += ' bottom';
            if (j%3===0) classes += ' left';
            if (j===8) classes += ' right';

            const td = document.createElement('td');
            td.className=classes.trim();

            const inputEl = document.createElement('input');
            inputEl.type='number';
            inputEl.min='0';
            inputEl.max='9';
            inputEl.value= sudoku.puzzle[index] || '';
            inputEl.oninput=function() {
                this.value=this.value.slice(0,1);
            };
            td.appendChild(inputEl);
            tr.appendChild(td);
        }

        tbody.appendChild(tr);
    }

    table.appendChild(tbody);
    container.appendChild(table);
}

// Проверка решения
async function checkSolution() {
    if (!currentSudoku) return;

    // Собираем решение из таблицы
    const inputs = document.querySelectorAll('#currentSudoku input');

    const solution = Array.from(inputs).map(input => parseInt(input.value) || 0);

    // Отправляем на проверку
    const response = await fetch(`/api/check_sudoku`, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({id : currentSudoku.id, solution})
    });

    const resultData= await response.json();

    document.getElementById('resultMsg').textContent= resultData.correct ? 'Решение верное!' : 'Решение неверное!';
}

// Обработка выхода из аккаунта
document.getElementById('logoutBtn').addEventListener('click', () => {
  localStorage.removeItem('token');
  alert('Вы вышли из аккаунта');
  window.location.href = '/login.html';
});

// Обработка перехода к решателю судоку
document.getElementById('solveBtn').addEventListener('click', () => {
  window.location.href = '/sudoku.html';
});

// Инициализация
document.getElementById('checkBtn').onclick=checkSolution;

loadSudokus();

</script>
</body>
</html>